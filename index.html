<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="description" content="Monitor all your investments and watch your wealth grow with compound interest calculations">
    <meta name="theme-color" content="#218090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Savings Tracker">
    <meta name="apple-mobile-web-app-status-bar" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%23218090' width='192' height='192'/><text x='96' y='120' font-size='100' font-weight='bold' text-anchor='middle' fill='white'>ðŸ’°</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23218090' width='180' height='180' rx='45'/><text x='90' y='115' font-size='90' font-weight='bold' text-anchor='middle' fill='white'>ðŸ’°</text></svg>">
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Financial%20Savings%20Tracker%22,%22short_name%22:%22Savings%20Tracker%22,%22start_url%22:%22./%22,%22display%22:%22standalone%22,%22background_color%22:%22%23ffffff%22,%22theme_color%22:%22%23218090%22,%22scope%22:%22./%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 192 192%27><rect fill=%27%23218090%27 width=%27192%27 height=%27192%27/><text x=%2796%27 y=%27120%27 font-size=%27100%27 font-weight=%27bold%27 text-anchor=%27middle%27 fill=%27white%27>ðŸ’°</text></svg>%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22,%22purpose%22:%22any%22}]}">
    <title>Financial Savings Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --color-bg-primary: #fafaf8;
            --color-bg-secondary: #f5f5f5;
            --color-surface: #ffffff;
            --color-text-primary: #1f2121;
            --color-text-secondary: #626c7c;
            --color-primary: #218090;
            --color-primary-hover: #1d7280;
            --color-success: #22c55e;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --color-border: rgba(94, 82, 64, 0.15);
            --color-input-bg: #ffffff;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius-base: 8px;
            --spacing-8: 8px;
            --spacing-12: 12px;
            --spacing-16: 16px;
            --spacing-20: 20px;
            --spacing-24: 24px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-bg-primary: #1f2121;
                --color-bg-secondary: #2a2a2a;
                --color-surface: #262626;
                --color-text-primary: #f5f5f5;
                --color-text-secondary: #a7a9a9;
                --color-input-bg: #333333;
                --color-border: rgba(167, 169, 169, 0.2);
            }
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            position: fixed;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            line-height: 1.5;
            padding: max(0px, env(safe-area-inset-top)) max(0px, env(safe-area-inset-right)) max(0px, env(safe-area-inset-bottom)) max(0px, env(safe-area-inset-left));
            display: flex;
            flex-direction: column;
        }

        .container {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            width: 100%;
        }

        header {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            padding: var(--spacing-16);
            border-radius: 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        h1 {
            margin: 0 0 var(--spacing-8) 0;
            font-size: 24px;
            font-weight: 600;
        }

        .header-subtitle {
            color: var(--color-text-secondary);
            font-size: 13px;
        }

        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 0;
            border-bottom: 1px solid var(--color-border);
            background: var(--color-surface);
            padding: 0;
            border-radius: 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            position: sticky;
            top: 0;
            z-index: 9;
        }

        .tab-btn {
            padding: var(--spacing-12) var(--spacing-16);
            border: none;
            background: transparent;
            cursor: pointer;
            color: var(--color-text-secondary);
            font-weight: 500;
            font-size: 13px;
            border-bottom: 3px solid transparent;
            transition: all 150ms ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-btn:active {
            background: var(--color-bg-secondary);
        }

        .tab-content {
            display: none;
            padding: var(--spacing-16);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: var(--spacing-16);
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: var(--spacing-8);
            font-size: 13px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 16px;
            background: var(--color-input-bg);
            color: var(--color-text-primary);
            transition: border-color 150ms ease;
            -webkit-appearance: none;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 128, 144, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-16);
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 150ms ease;
            -webkit-appearance: none;
            width: 100%;
        }

        .btn-primary {
            background: var(--color-primary);
            color: #ffffff;
        }

        .btn-primary:active {
            background: var(--color-primary-hover);
        }

        .btn-danger {
            background: var(--color-error);
            color: #ffffff;
            width: auto;
            padding: var(--spacing-8) var(--spacing-12);
            font-size: 12px;
        }

        .btn-danger:active {
            opacity: 0.8;
        }

        .investment-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: var(--spacing-16);
            margin-bottom: var(--spacing-16);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-12);
            gap: var(--spacing-12);
        }

        .card-title {
            font-weight: 600;
            font-size: 15px;
            margin: 0;
            flex: 1;
        }

        .card-type {
            display: inline-block;
            background: rgba(33, 128, 144, 0.1);
            color: var(--color-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .card-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-12);
            margin-bottom: var(--spacing-12);
        }

        .card-stat {
            padding: var(--spacing-12);
            background: var(--color-bg-secondary);
            border-radius: 6px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-4);
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text-primary);
        }

        .stat-profit {
            color: var(--color-success);
        }

        .stat-loss {
            color: var(--color-error);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-12);
            margin-bottom: var(--spacing-20);
        }

        .stat-box {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: var(--spacing-16);
        }

        .chart-container {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: var(--spacing-16);
            margin-bottom: var(--spacing-16);
            position: relative;
            height: 300px;
        }

        .empty-state {
            text-align: center;
            padding: var(--spacing-24);
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: var(--spacing-12);
        }

        .install-banner {
            display: none;
            background: var(--color-primary);
            color: white;
            padding: var(--spacing-12) var(--spacing-16);
            text-align: center;
            font-size: 13px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .install-banner.show {
            display: block;
        }

        .install-banner button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            margin-left: var(--spacing-8);
            cursor: pointer;
            font-weight: 500;
            font-size: 12px;
            -webkit-appearance: none;
        }

        .install-banner button:active {
            background: rgba(255, 255, 255, 0.3);
        }

        h3 {
            margin-top: 0;
            margin-bottom: var(--spacing-16);
            font-size: 16px;
        }

        p {
            margin: 0 0 var(--spacing-12) 0;
        }

        @supports (padding: max(0px)) {
            body {
                padding-left: max(16px, env(safe-area-inset-left));
                padding-right: max(16px, env(safe-area-inset-right));
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }
            
            header {
                padding-left: max(16px, env(safe-area-inset-left));
                padding-right: max(16px, env(safe-area-inset-right));
            }

            .tab-content {
                padding-left: max(16px, env(safe-area-inset-left));
                padding-right: max(16px, env(safe-area-inset-right));
            }
        }
    </style>
</head>
<body>
    <div id="installBanner" class="install-banner">
        ðŸ“± Add to home screen for quick access
        <button onclick="installApp()">Install</button>
    </div>

    <header>
        <h1>ðŸ’° Savings Tracker</h1>
        <p class="header-subtitle">Track investments & watch wealth grow</p>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('dashboard')">Dashboard</button>
        <button class="tab-btn" onclick="switchTab('add')">Add</button>
        <button class="tab-btn" onclick="switchTab('investments')">Investments</button>
        <button class="tab-btn" onclick="switchTab('calculator')">Calculator</button>
    </div>

    <div class="container">
        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Total Invested</div>
                    <div class="stat-value">â‚¹<span id="totalInvested">0</span></div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Current Value</div>
                    <div class="stat-value">â‚¹<span id="totalValue">0</span></div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Profit</div>
                    <div class="stat-value" id="totalProfit">â‚¹0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Profit %</div>
                    <div class="stat-value" id="profitPercent">0%</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="growthChart"></canvas>
            </div>

            <div class="chart-container">
                <canvas id="investmentTypeChart"></canvas>
            </div>
        </div>

        <!-- ADD INVESTMENT TAB -->
        <div id="add" class="tab-content">
            <div class="investment-card">
                <h3>Add New Investment</h3>

                <div class="form-group">
                    <label class="form-label">Investment Type</label>
                    <select class="form-control" id="investmentType" onchange="updateRateHint()">
                        <option value="ppf">PPF - ~7-8%</option>
                        <option value="rd">Recurring Deposit - ~6-7%</option>
                        <option value="sip">Mutual Fund SIP - ~10-16%</option>
                        <option value="nsc">NSC - ~8.2%</option>
                        <option value="gold">Digital Gold - ~8-12%</option>
                        <option value="fd">Fixed Deposit - ~6-7%</option>
                        <option value="other">Other - Custom</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Monthly (â‚¹)</label>
                        <input type="number" class="form-control" id="monthlyAmount" placeholder="500" min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rate (%)</label>
                        <input type="number" class="form-control" id="interestRate" placeholder="7.5" step="0.1" min="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Duration (Years)</label>
                        <input type="number" class="form-control" id="duration" placeholder="5" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="startDate">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Name (Optional)</label>
                    <input type="text" class="form-control" id="investmentName" placeholder="My PPF">
                </div>

                <button class="btn btn-primary" onclick="addInvestment()">Add Investment</button>
            </div>
        </div>

        <!-- INVESTMENTS LIST TAB -->
        <div id="investments" class="tab-content">
            <div id="investmentsList"></div>
        </div>

        <!-- CALCULATOR TAB -->
        <div id="calculator" class="tab-content">
            <div class="investment-card">
                <h3>Compound Interest</h3>
                <p style="color: var(--color-text-secondary); font-size: 13px;">See how your money grows</p>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Principal (â‚¹)</label>
                        <input type="number" class="form-control" id="calcPrincipal" placeholder="10000" min="0" onchange="calculateCompound()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rate (%)</label>
                        <input type="number" class="form-control" id="calcRate" placeholder="7.5" step="0.1" min="0" onchange="calculateCompound()">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Years</label>
                        <input type="number" class="form-control" id="calcTime" placeholder="5" min="1" max="100" onchange="calculateCompound()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Frequency</label>
                        <select class="form-control" id="calcFreq" onchange="calculateCompound()">
                            <option value="1">Annually</option>
                            <option value="2">Semi-Annual</option>
                            <option value="4">Quarterly</option>
                            <option value="12">Monthly</option>
                        </select>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Principal</div>
                        <div class="stat-value">â‚¹<span id="calcPrincipalResult">0</span></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Interest</div>
                        <div class="stat-value stat-profit">â‚¹<span id="calcInterestResult">0</span></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Final</div>
                        <div class="stat-value">â‚¹<span id="calcFinalResult">0</span></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">ROI %</div>
                        <div class="stat-value stat-profit"><span id="calcROI">0</span>%</div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="calculatorChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let investments = JSON.parse(localStorage.getItem('investments')) || [];
        let growthChart, investmentTypeChart, calculatorChart;

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                setTimeout(() => initGrowthChart(), 100);
            } else if (tabName === 'calculator') {
                setTimeout(() => initCalculatorChart(), 100);
            }
        }

        function updateRateHint() {
            const type = document.getElementById('investmentType').value;
            const rateMap = {'ppf': 7.5, 'rd': 6.5, 'sip': 12, 'nsc': 8.2, 'gold': 10, 'fd': 6.5, 'other': 7};
            document.getElementById('interestRate').value = rateMap[type];
        }

        function addInvestment() {
            const type = document.getElementById('investmentType').value;
            const monthly = parseFloat(document.getElementById('monthlyAmount').value);
            const rate = parseFloat(document.getElementById('interestRate').value);
            const duration = parseInt(document.getElementById('duration').value);
            const startDate = document.getElementById('startDate').value;
            const name = document.getElementById('investmentName').value || getTypeName(type);

            if (!monthly || !rate || !duration || !startDate) {
                alert('Fill all fields');
                return;
            }

            investments.push({id: Date.now(), type, name, monthlyAmount: monthly, interestRate: rate, duration, startDate, createdAt: new Date().toISOString()});
            localStorage.setItem('investments', JSON.stringify(investments));
            clearAddForm();
            switchTab('investments');
            displayInvestments();
            updateDashboard();
        }

        function clearAddForm() {
            document.getElementById('monthlyAmount').value = '';
            document.getElementById('interestRate').value = '';
            document.getElementById('duration').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('investmentName').value = '';
        }

        function getTypeName(type) {
            const names = {'ppf': 'PPF', 'rd': 'RD', 'sip': 'SIP', 'nsc': 'NSC', 'gold': 'Gold', 'fd': 'FD', 'other': 'Investment'};
            return names[type] || 'Investment';
        }

        function calculateFutureValue(monthly, rate, years) {
            const months = years * 12;
            const monthlyRate = rate / 100 / 12;
            if (monthlyRate === 0) return monthly * months;
            return monthly * (((1 + monthlyRate) ** months - 1) / monthlyRate);
        }

        function calculateTotalInvested(monthly, years) {
            return monthly * years * 12;
        }

        function deleteInvestment(id) {
            if (confirm('Delete this investment?')) {
                investments = investments.filter(inv => inv.id !== id);
                localStorage.setItem('investments', JSON.stringify(investments));
                displayInvestments();
                updateDashboard();
            }
        }

        function displayInvestments() {
            const container = document.getElementById('investmentsList');
            if (investments.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ðŸ“Š</div><p>No investments yet. Start adding!</p></div>';
                return;
            }

            let html = '';
            investments.forEach(inv => {
                const future = calculateFutureValue(inv.monthlyAmount, inv.interestRate, inv.duration);
                const invested = calculateTotalInvested(inv.monthlyAmount, inv.duration);
                const profit = future - invested;
                const profitPercent = ((profit / invested) * 100).toFixed(2);

                html += `
                    <div class="investment-card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">${inv.name}</h3>
                                <span class="card-type">${getTypeName(inv.type)}</span>
                            </div>
                            <button class="btn btn-danger" onclick="deleteInvestment(${inv.id})">Delete</button>
                        </div>
                        <div class="card-grid">
                            <div class="card-stat">
                                <div class="stat-label">Monthly</div>
                                <div class="stat-value">â‚¹${inv.monthlyAmount.toLocaleString()}</div>
                            </div>
                            <div class="card-stat">
                                <div class="stat-label">Rate</div>
                                <div class="stat-value">${inv.interestRate}%</div>
                            </div>
                            <div class="card-stat">
                                <div class="stat-label">Duration</div>
                                <div class="stat-value">${inv.duration} Yrs</div>
                            </div>
                            <div class="card-stat">
                                <div class="stat-label">Start</div>
                                <div class="stat-value">${new Date(inv.startDate).toLocaleDateString()}</div>
                            </div>
                            <div class="card-stat">
                                <div class="stat-label">Invested</div>
                                <div class="stat-value">â‚¹${invested.toLocaleString(undefined, {maximumFractionDigits: 0})}</div>
                            </div>
                            <div class="card-stat">
                                <div class="stat-label">Future</div>
                                <div class="stat-value">â‚¹${future.toLocaleString(undefined, {maximumFractionDigits: 0})}</div>
                            </div>
                            <div class="card-stat">
                                <div class="stat-label">Profit</div>
                                <div class="stat-value stat-profit">â‚¹${profit.toLocaleString(undefined, {maximumFractionDigits: 0})}</div>
                            </div>
                            <div class="card-stat">
                                <div class="stat-label">ROI %</div>
                                <div class="stat-value stat-profit">${profitPercent}%</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updateDashboard() {
            let totalInvested = 0, totalValue = 0;
            investments.forEach(inv => {
                const future = calculateFutureValue(inv.monthlyAmount, inv.interestRate, inv.duration);
                const invested = calculateTotalInvested(inv.monthlyAmount, inv.duration);
                totalInvested += invested;
                totalValue += future;
            });

            const profit = totalValue - totalInvested;
            const profitPercent = totalInvested > 0 ? ((profit / totalInvested) * 100).toFixed(2) : 0;

            document.getElementById('totalInvested').textContent = totalInvested.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('totalValue').textContent = totalValue.toLocaleString(undefined, {maximumFractionDigits: 0});

            const profitElement = document.getElementById('totalProfit');
            profitElement.textContent = 'â‚¹' + profit.toLocaleString(undefined, {maximumFractionDigits: 0});
            profitElement.className = 'stat-value ' + (profit >= 0 ? 'stat-profit' : 'stat-loss');

            const percentElement = document.getElementById('profitPercent');
            percentElement.textContent = profitPercent + '%';
            percentElement.className = 'stat-value ' + (profitPercent >= 0 ? 'stat-profit' : 'stat-loss');
        }

        function initGrowthChart() {
            if (investments.length === 0) return;
            const ctx = document.getElementById('growthChart');
            if (!ctx) return;
            
            const years = Math.max(...investments.map(inv => inv.duration));
            const datasets = [];
            const colors = ['#218090', '#f59e0b', '#ef4444', '#22c55e', '#3b82f6', '#8b5cf6', '#ec4899'];
            let colorIndex = 0;

            investments.forEach(inv => {
                const data = [];
                for (let year = 0; year <= inv.duration; year++) {
                    data.push(calculateFutureValue(inv.monthlyAmount, inv.interestRate, year));
                }
                datasets.push({
                    label: inv.name,
                    data: data,
                    borderColor: colors[colorIndex % colors.length],
                    backgroundColor: colors[colorIndex % colors.length] + '20',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true
                });
                colorIndex++;
            });

            if (growthChart) growthChart.destroy();
            growthChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: Array.from({length: Math.max(...investments.map(inv => inv.duration + 1))}, (_, i) => `Y${i}`),
                    datasets: datasets
                },
                options: {responsive: true, maintainAspectRatio: false, plugins: {legend: {position: 'top'}}, scales: {y: {beginAtZero: true}}}
            });

            const typeCtx = document.getElementById('investmentTypeChart');
            if (typeCtx && investmentTypeChart) investmentTypeChart.destroy();
            investmentTypeChart = new Chart(typeCtx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: investments.map(inv => inv.name),
                    datasets: [{data: investments.map(inv => calculateTotalInvested(inv.monthlyAmount, inv.duration)), backgroundColor: colors}]
                },
                options: {responsive: true, maintainAspectRatio: false}
            });
        }

        function calculateCompound() {
            const principal = parseFloat(document.getElementById('calcPrincipal').value) || 0;
            const rate = parseFloat(document.getElementById('calcRate').value) || 0;
            const time = parseInt(document.getElementById('calcTime').value) || 0;
            const freq = parseInt(document.getElementById('calcFreq').value) || 1;

            const amount = principal * Math.pow(1 + (rate / 100 / freq), freq * time);
            const interest = amount - principal;
            const roi = principal > 0 ? ((interest / principal) * 100).toFixed(2) : 0;

            document.getElementById('calcPrincipalResult').textContent = principal.toLocaleString();
            document.getElementById('calcInterestResult').textContent = interest.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('calcFinalResult').textContent = amount.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('calcROI').textContent = roi;

            initCalculatorChart();
        }

        function initCalculatorChart() {
            const principal = parseFloat(document.getElementById('calcPrincipal').value) || 0;
            const rate = parseFloat(document.getElementById('calcRate').value) || 0;
            const time = parseInt(document.getElementById('calcTime').value) || 1;
            const freq = parseInt(document.getElementById('calcFreq').value) || 1;

            if (principal === 0) return;

            const ctx = document.getElementById('calculatorChart');
            if (!ctx) return;

            const labels = [];
            const principalData = [];
            const interestData = [];

            for (let year = 0; year <= time; year++) {
                labels.push(`Y${year}`);
                const amount = principal * Math.pow(1 + (rate / 100 / freq), freq * year);
                principalData.push(principal);
                interestData.push(amount - principal);
            }

            if (calculatorChart) calculatorChart.destroy();
            calculatorChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {label: 'Principal', data: principalData, backgroundColor: '#218090', borderRadius: 4},
                        {label: 'Interest', data: interestData, backgroundColor: '#22c55e', borderRadius: 4}
                    ]
                },
                options: {responsive: true, maintainAspectRatio: false, scales: {x: {stacked: true}, y: {stacked: true}}}
            });
        }

        let deferredPrompt;
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript,' + encodeURIComponent(`
                const CACHE = 'savings-v1';
                self.addEventListener('install', e => {self.skipWaiting();});
                self.addEventListener('activate', e => {self.clients.claim();});
                self.addEventListener('fetch', e => {
                    if(e.request.method!=='GET')return;
                    e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));
                });
            `)).catch(e=>console.log('SW failed'));
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBanner').classList.add('show');
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(() => {
                    deferredPrompt = null;
                    document.getElementById('installBanner').classList.remove('show');
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            updateRateHint();
            displayInvestments();
            updateDashboard();
        });
    </script>
</body>
</html>
